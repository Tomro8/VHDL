% !TEX TS-program = pdflatex
% !TEX encoding = UTF-8 Unicode

% This is a simple template for a LaTeX document using the "article" class.
% See "book", "report", "letter" for other types of document.

\documentclass[]{article}

\usepackage[utf8]{inputenc} % set input encoding (not needed with XeLaTeX)

%%% PAGE DIMENSIONS
\usepackage{geometry} % to change the page dimensions
\geometry{a4paper} % or letterpaper (US) or a5paper or....
% \geometry{margin=1in} % for example, change the margins to 2 inches all round
% \geometry{landscape} % set up the page for landscape
%   read geometry.pdf for detailed page layout information

\usepackage{graphicx} % support the \includegraphics command and options

% \usepackage[parfill]{parskip} % Activate to begin paragraphs with an empty line rather than an indent

%%% PACKAGES
\usepackage{booktabs} % for much better looking tables
\usepackage{array} % for better arrays (eg matrices) in maths
\usepackage{paralist} % very flexible & customisable lists (eg. enumerate/itemize, etc.)
\usepackage{verbatim} % adds environment for commenting out blocks of text & for better verbatim
\usepackage{subfig} % make it possible to include more than one captioned figure/table in a single float
\usepackage{microtype} %makes awesome kerning and punctuation come half way out the edge of the text
\usepackage{listings} %for code listings
\usepackage{color} %for colored syntax highligting

%%% Code listing
\definecolor{mygreen}{rgb}{0,0.6,0}
\definecolor{mygray}{rgb}{0.5,0.5,0.5}
\definecolor{mymauve}{rgb}{0.58,0,0.82}
\lstset{breaklines=true,
basicstyle=\footnotesize\ttfamily,
commentstyle=\color{mygreen},
keywordstyle=\color{blue},
numberstyle=\tiny\color{mygray},
tabsize=2,
language=c
}

% to include a file as a listing: \lstinputlisting{intio.c}
% inline listing: \begin{lstlisting}[frame=single]

%%% HEADERS & FOOTERS
\usepackage{fancyhdr} % This should be set AFTER setting up the page geometry
\pagestyle{fancy} % options: empty , plain , fancy
\renewcommand{\headrulewidth}{0pt} % customise the layout...
\lhead{}\chead{}\rhead{}
\lfoot{}\cfoot{\thepage}\rfoot{}

%%% ToC (table of contents) APPEARANCE
\usepackage[nottoc,notlof,notlot]{tocbibind} % Put the bibliography in the ToC
\usepackage[titles,subfigure]{tocloft} % Alter the style of the Table of Contents
%\renewcommand{\cftsecfont}{\rmfamily\mdseries\upshape}
%\renewcommand{\cftsecpagefont}{\rmfamily\mdseries\upshape} % No bold!
\usepackage{hyperref} % use hyperlinked ToC
\hypersetup{colorlinks=true, linkcolor=black}

%%%-------------------------------------------------------------------


\title{Complete Design of Vector Display Processor}
\author{Oskar Weigl - ow610\\ and \\ Ryan Savitski - rs510}
%\date{} % Activate to display a given date or no date (if empty),
         % otherwise the current date is printed 

\begin{document}
\maketitle

%\renewcommand{\abstractname}{Summary}
%\begin{abstract}
%	Write the abstract here
%\end{abstract}

\tableofcontents
\clearpage

\section{Operation}
The following features are implemented:
\begin{itemize}
	\item Line drawing:
	\begin{itemize}
		\item All colors
		\item All directions
		\item Any length (including one pixel and entire screen)
	\end{itemize}
	\item Fills (Clearscreen)
	\begin{itemize}
		\item All colors
		\item All directions
		\item Any size
		\item Crossing any cache word boundary
	\end{itemize}
\end{itemize}

\section{Tests} % (fold)
\label{sec:tests}

\subsection{First Test} % (fold)
\label{sub:first_test}

This inital test tests the basic operation of the hardware, with no special corner case consideration. It tests the following:
\begin{itemize}
	\item Drawing lines in all 8 octants (including horizontal/vertical).
	\item White/black/invert lines.
	\item Basic fill with black color with coordinates specified as bottom left to top right.
\end{itemize}

In terms of hardware, this tests:
\begin{itemize}
	\item That commands are handled properly.
	\item That interfaces are not violated.
	\item That the line drawing fsm and caching fsm are working.
	\item That color selection works for lines.
	\item That basic filling works.
\end{itemize}

% subsection first_test (end)

\subsection{Second Test} % (fold)
\label{sub:second_test}
This test checks that the hardware can handle multipoint lines. That is, line segment sequences without a move command in-between. It also extends the fill tests to handle all colors: black, white and invert.

In addition to the previous tests, this test checks the correct implementation of saving the state of cursor, and that the different colors work with the fills.

% subsection second_test (end)

\subsection{Third Test} % (fold)
\label{sub:third_test}

This test checks fills in all directions. The fill implementation works by always filling from bottom left to top right, and if the incoming command has any other direction, it swaps the start and end coordinates accordingly. This test checks that the swaps are successful.

% subsection third_test (end)

\subsection{Fourth Test} % (fold)
\label{sub:fourth_test}

This test checks the corner case of lines and fills that are only a single pixel long/wide. It also checks for fills that are a single pixel tall or a single pixel wide, but where the other dimension is of normal size.
As there is special handling of single pixel lines/fills in the draw block, this type of test will make sure that this special handling works. This also checks that the ram control block can handle start and end points that share the same x or y coordinate. That is, it checks that the swap comparisons do not contain any off-by-one error or similar.

% subsection forth_test (end)

\subsection{Fith Test} % (fold)
\label{sub:fith_test}

This test draws lines that are longer than half the size of the screen. In particular, it draws a line from corner to corner. This checks that the variables in the \verb"draw_octant" block have enough bits to not overflow on large lines.

This test uncovered a bug in the \verb"draw_octant" code that was provided. It used a cast to \verb"signed" from \verb"unsigned" which broke if the top bit was set. That is, it used \verb"signed(xincr)" instead of \verb"signed('0' & xincr)". This bug was corrected at this point.

% subsection fith_test (end)

\subsection{Sixth Test} % (fold)
\label{sub:sixth_test}

This test does a fill in the reversed direction (top right to bottom left) which is localised to a single cache block. This will check if the swapping of start and end points for the fill will occur if the fill is inside a single block.
The test also does a (reversed) 2x2 fill that perfectly straddles four cache block boundaries. This will check that fills that require only a single pixel per block works, and also checks that the correct blocks are loaded for the correct pixels.
This test also does a fill over the entire screen. This checks that the fill sequencing counters are wide enough and don't overflow.

A bug was discovered when doing a reversed fill that was localised to a single cache block. It turns out that the code didn't cover this case. The bug was fixed at this point.

% subsection sixth_test (end)

\subsection{Seventh Test} % (fold)
\label{sub:seventh_test}

Using feedback from the code coverage tools of Modelsim, we discovered that some FSM transitions in the Draw Block were not exercised. That is, so far there has pretty much always been a move command between drawing of lines and fills. To make sure that these transitions are also covered, the following commands amend the tests:
\begin{itemize}
	\item fill $\rightarrow$ line
	\item fill $\rightarrow$ single pix
	\item line $\rightarrow$ fill
	\item line $\rightarrow$ single pix
	\item single pix $\rightarrow$ fill
	\item single pix $\rightarrow$ line
	\item move $\rightarrow$ move
\end{itemize}

% subsection seventh_test (end)

\subsection{Eighth Test} % (fold)
\label{sub:eighth_test}

Further checking the code coverage, we found that the function that resolves the command to be stored in the operation cache when the new command is \verb"invert" is only applied to \verb"same".
We added some commands that would do all types of fills on top of all other types of fill, all within the same cache block. This is so that we can check that the combination of old and new commands without flushing the cache works.

% subsection eighth_test (end)

% section tests (end)

\section{Coverage Analysis} % (fold)
\label{sec:coverage_analysis}

What isn't covered and why
%TODO write about anything that could be missed by pure coverage, to at least show that we understand that 100% doesn't mean a working design

% section coverage_analysis (end)

\section{Synthesis and Post Synthesis} % (fold)
\label{sec:synthesis_and_post_synthesis}

\subsection{Synthesis Warnings} % (fold)
\label{sub:synthesis_warnings}

Several synthesis warnings were encountered. Some prompted for fixes of the code, while others were assessed to be safe to ignore. The only synthesiser warnings that required fixing was inferred latches for incompletely driven signals in the combinatorial block. This was easily fixed by using a default assignment at the top of the block. The following synthesis warnings were assesed to be safe to ignore:
\begin{itemize}
	\item \verb"Variable startxblock read before being assigned." This warning is generated because \verb"startxblock" is only written in the state \verb"fill" and read in the state \verb"do_fill". This is in fact fine, as the state \verb"do_fill" can only be entered from the state \verb"fill". A way of doing this that would avoid raising this warning would be to use a signal to communicate. However, the reason for using a variable was that this communication is isolated to the process and it seems unnecessary to litter the architecture name-space.
	\item \verb"OTHERS clause is not synthesized". This is part of a function that returns \verb"XX" when the inputs are undefined. However, when synthesised, the inputs will always be defined, so this case is dropped. This is fine.
	\item \verb"Pruning register ..." For some parts of the code, the easiest way to do in-place operations is to make a shadowing variable that always get news values at the start of the process. This means that the variables never need to save any state between clock edges, and as such they are pruned. Thus, this is the expected behaviour, and as such the warnings are safely ignored.
	\item \verb"Input xbias is unused". This is expected, as the design does not use \verb"xbias".
	\item \verb"Register bit ...state[5] is always 0". The synthesiser generates one-hot encoding (as verified by checking synthesis notes). The pruned bit is because we include an unreachable state called \verb"UNINITIALISED" as the first item in the state type. This is meant to serve analogously to \verb"'U'" of \verb"std_logic", that is, to detect improper reset behaviour during simulation. The fact that the synthesis tool chose to ignore this state is exactly as per design: the same way that \verb"'U'" is ignored.
\end{itemize}


% subsection synthesis_warnings (end)

% section synthesis_and_post_synthesis (end)

\section{Ryans Unifinished Stuff} % (fold)
\label{sec:ryans_unifinished_stuff}

===
RCB synthesis warnings
Various registers pruned: expected
others clauses not synthed


==
postsynth: open port problem: ciel(logstuff)
test 8 and josh's fuzzer works postsynth

% section ryans_unifinished_stuff (end)

\end{document}
